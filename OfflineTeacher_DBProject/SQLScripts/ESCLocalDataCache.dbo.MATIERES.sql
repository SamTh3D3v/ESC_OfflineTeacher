/****
This SQL script was generated by the Configure Data Synchronization
dialog box. This script contains statements that create the
change-tracking columns, deleted-items table, and triggers on the
server database. These database objects are required by Synchronization
Services to successfully synchronize data between client and server
databases. For more information, see the
‘How to: Configure a Database Server for Synchronization’ topic in Help.
****/


IF @@TRANCOUNT > 0
set ANSI_NULLS ON 
set QUOTED_IDENTIFIER ON 

GO
BEGIN TRANSACTION;


IF @@TRANCOUNT > 0
ALTER TABLE [dbo].[MATIERES] 
ADD [LastEditDate] DateTime NULL CONSTRAINT [DF_MATIERES_LastEditDate] DEFAULT (GETUTCDATE()) WITH VALUES
GO
IF @@ERROR <> 0 
     ROLLBACK TRANSACTION;


IF @@TRANCOUNT > 0
ALTER TABLE [dbo].[MATIERES] 
ADD [CreationDate] DateTime NULL CONSTRAINT [DF_MATIERES_CreationDate] DEFAULT (GETUTCDATE()) WITH VALUES
GO
IF @@ERROR <> 0 
     ROLLBACK TRANSACTION;


IF @@TRANCOUNT > 0
IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MATIERES_UpdateTrigger]') AND type = 'TR') 
   DROP TRIGGER [dbo].[MATIERES_UpdateTrigger] 

GO
CREATE TRIGGER [dbo].[MATIERES_UpdateTrigger] 
    ON [dbo].[MATIERES] 
    AFTER UPDATE 
AS 
BEGIN 
    SET NOCOUNT ON 
    UPDATE [dbo].[MATIERES] 
    SET [LastEditDate] = GETUTCDATE() 
    FROM inserted 
    WHERE inserted.[ID_MATIERE] = [MATIERES].[ID_MATIERE] 
END;
GO
IF @@ERROR <> 0 
     ROLLBACK TRANSACTION;


IF @@TRANCOUNT > 0
IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MATIERES_InsertTrigger]') AND type = 'TR') 
   DROP TRIGGER [dbo].[MATIERES_InsertTrigger] 

GO
CREATE TRIGGER [dbo].[MATIERES_InsertTrigger] 
    ON [dbo].[MATIERES] 
    AFTER INSERT 
AS 
BEGIN 
    SET NOCOUNT ON 
    UPDATE [dbo].[MATIERES] 
    SET [CreationDate] = GETUTCDATE() 
    FROM inserted 
    WHERE inserted.[ID_MATIERE] = [MATIERES].[ID_MATIERE] 
END;
GO
IF @@ERROR <> 0 
     ROLLBACK TRANSACTION;
COMMIT TRANSACTION;
